# ğŸ¦¾ `pip_control` æ¨¡å—è¯´æ˜æ–‡æ¡£

> **åŠŸèƒ½**ï¼šæ¥æ”¶ç›®æ ‡æŠ“å–ç‚¹ï¼ˆé€šå¸¸ç”±è§†è§‰ç³»ç»Ÿæä¾›ï¼‰ï¼Œæ‰§è¡ŒæŠ“å–åŠ¨ä½œï¼ˆè°ƒç”¨ MoveIt è¿›è¡Œè¿åŠ¨è§„åˆ’ + æ‰§è¡Œ + æ§åˆ¶å¤¹çˆªï¼‰ï¼Œæ˜¯æœºå™¨äººæŠ“å–ä»»åŠ¡çš„æ ¸å¿ƒæ§åˆ¶ä¸­å¿ƒã€‚

---

## ğŸ§© æ¨¡å—åŠŸèƒ½æ¦‚è§ˆ

- æ¥æ”¶æ¥è‡ªè§†è§‰ç³»ç»Ÿçš„æŠ“å–ç›®æ ‡åæ ‡ï¼ˆ`geometry_msgs/PointStamped`ï¼‰
- å°†ç›®æ ‡ä» `camera_link` åæ ‡ç³»å˜æ¢åˆ° `base_link`
- æ„é€ æŠ“å–ç›®æ ‡çº¦æŸï¼ˆä½ç½® + å§¿æ€ï¼‰
- é€šè¿‡ ROS 2 Action å‘é€ç»™ MoveItï¼Œæ§åˆ¶æœºæ¢°è‡‚ç§»åŠ¨è‡³ç›®æ ‡ä½ç½®
- æŠ“å–å®Œæˆåï¼Œè°ƒç”¨å¤¹çˆªæ§åˆ¶èŠ‚ç‚¹å¯¹ `joint6` æ—‹è½¬ã€`joint7` å¼€åˆ ï¼ˆå¾…å®Œæˆï¼‰

---

## ğŸš€ å·¥ä½œæµç¨‹å›¾
åˆæ­¥çš„è®¾æƒ³ï¼Œå§¿æ€æ§åˆ¶ä¸€ç›´å¤±è´¥ï¼Œè¿˜éœ€è¦å®Œå–„


```mermaid
graph TD
    A[è§†è§‰æ£€æµ‹èŠ‚ç‚¹] -->|ç›®æ ‡ç‚¹å‘å¸ƒ /camera_target_point| B[grasp_server]
    B --> C[TF åæ ‡å˜æ¢ camera_link â†’ base_link]
    C --> D[æ„é€  Pose + è¿åŠ¨çº¦æŸ]
    D --> E[é€šè¿‡ ROS2 Action å‘é€ç»™ MoveIt]
    E -->|åˆ°è¾¾ç›®æ ‡| F[è°ƒç”¨ gripper_controller æ§åˆ¶ joint6 å’Œ joint7]
    F --> G[å®ŒæˆæŠ“å–]
```

---

## ğŸ“¦ èŠ‚ç‚¹ä¿¡æ¯

### èŠ‚ç‚¹åï¼š
```bash
grasp_server
```

### è®¢é˜…è¯é¢˜ï¼š
- `/camera_target_point` (ç±»å‹ï¼š`geometry_msgs/PointStamped`)
  - æ¥è‡ªè§†è§‰æ£€æµ‹æ¨¡å—ï¼Œè¡¨ç¤ºç›®æ ‡ç‰©ä½“åœ¨ `camera_link` ä¸­çš„ç©ºé—´åæ ‡

### ä½¿ç”¨ Serviceï¼š
- `grasp_command`ï¼ˆç±»å‹ï¼š`GraspCommand.srv`ï¼Œä½ å®šä¹‰çš„æŠ“å–æœåŠ¡ï¼‰
  - å¯åŠ¨ä¸€æ¬¡æŠ“å–æµç¨‹

### ä½¿ç”¨ Actionï¼š
- `/move_action`ï¼ˆç±»å‹ï¼š`moveit_msgs/action/MoveGroup`ï¼‰
  - ç”¨äºå°†æŠ“å–ç›®æ ‡ä½å§¿å‘é€ç»™ MoveIt æ‰§è¡ŒæŠ“å–è§„åˆ’
---

## ğŸ› ï¸ å‰ç½®ä¾èµ–

ç¡®ä¿ä»¥ä¸‹ä¾èµ–å’Œé…ç½®å·²ç»å‡†å¤‡å¥½ï¼š

| ä¾èµ–/é…ç½®               | è¯´æ˜                                                                 |
|------------------------|----------------------------------------------------------------------|
| âœ… è§†è§‰æ£€æµ‹èŠ‚ç‚¹         | å‘å¸ƒ `/camera_target_point`ï¼Œç›®æ ‡ç‚¹åæ ‡åº”åœ¨ `camera_link` ä¸‹        |
| âœ… TF åæ ‡æ ‘           | `camera_link` â†’ `base_link` çš„é™æ€ TF å˜æ¢éœ€è¦ç”¨ `static_transform_publisher` å‘å¸ƒ |
| âœ… MoveIt æ§åˆ¶é…ç½®     | å·²æ­£ç¡®åŠ è½½ URDFã€SRDFï¼Œè§„åˆ’ç»„åä¸º `"arm"`ï¼Œæœ«ç«¯æ‰§è¡Œå™¨ link ä¸º `"link6"` |
| âœ… `/move_action`       | MoveIt çš„ Action Server å·²æ­£å¸¸è¿è¡Œ                                 |
| âœ… `gripper_controller` | ç”¨äºæ§åˆ¶ `joint6`ï¼ˆå¤¹çˆªæ–¹å‘ï¼‰ å’Œ `joint7`ï¼ˆå¤¹çˆªå®½åº¦ï¼‰               |
| âœ… æœåŠ¡å®šä¹‰æ–‡ä»¶         | è‡ªå®šä¹‰ Service `GraspCommand.srv` å·²åŠ å…¥ `piper_msgs` åŒ…å¹¶ç¼–è¯‘       |

---

## âš™ï¸ å¯åŠ¨ä¸æµ‹è¯•

### å¯åŠ¨ grasp_serverï¼š

```bash
source install/setup.bash
ros2 run piper_control grasp_server
```

### æ¨¡æ‹Ÿç›®æ ‡ç‚¹è¾“å…¥ï¼ˆè§†è§‰æ›¿ä»£ï¼‰ï¼š

```bash
ros2 topic pub /camera_target_point geometry_msgs/PointStamped "{header: {frame_id: 'camera_link'}, point: {x: 0.4, y: 0.0, z: 0.2}}"
```

---

## ğŸ§  æ ¸å¿ƒæµç¨‹è¯´æ˜

### 1ï¸âƒ£ ç›‘å¬ `/camera_target_point`ï¼Œè½¬æ¢ä¸º `base_link` åæ ‡ç³»

ä½¿ç”¨ `tf2_ros` æŸ¥è¯¢æœ€æ–°çš„åæ ‡å˜æ¢ï¼Œå°†ç›®æ ‡ç‚¹å®æ—¶è½¬æ¢åˆ°æœºæ¢°è‡‚åŸºåæ ‡ç³»ä¸‹ã€‚

### 2ï¸âƒ£ æ„é€ æŠ“å– `PoseStamped` å’Œ `Constraints`

- **ä½ç½®çº¦æŸ**ï¼šå°†ç›®æ ‡ç‚¹è®¾ä¸ºä¸€ä¸ªå°ç«‹æ–¹ä½“åŒºåŸŸ
- **å§¿æ€çº¦æŸ**ï¼šä¿æŒå¤¹çˆªæ°´å¹³ï¼Œå…è®¸éƒ¨åˆ†æ—‹è½¬è‡ªç”±åº¦ï¼ˆå¯æŒ‰ä»»åŠ¡è°ƒæ•´ï¼‰

### 3ï¸âƒ£ å¼‚æ­¥å‘é€ç»™ MoveIt å¹¶ç›‘å¬åé¦ˆ

- åˆ›å»º MoveIt Action å®¢æˆ·ç«¯
- ç›‘å¬åé¦ˆ â†’ æ‰§è¡ŒæˆåŠŸåè¿›å…¥ä¸‹ä¸€é˜¶æ®µ

### 4ï¸âƒ£ æ§åˆ¶å¤¹çˆªæ—‹è½¬ä¸å¼€åˆï¼ˆè°ƒç”¨ gripper_controllerï¼‰

ä½¿ç”¨ ROS 2 Action æ–¹å¼å‘é€æŠ“å–è§’åº¦ + å¤¹çˆªå®½åº¦ã€‚

---

## ğŸ›‘ å¸¸è§é—®é¢˜ä¸è°ƒè¯•

| é—®é¢˜                                                   | è§£å†³æ–¹æ¡ˆ                                                             |
|--------------------------------------------------------|----------------------------------------------------------------------|
| âš ï¸ TF è½¬æ¢å¤±è´¥ï¼šcamera_link ä¸å­˜åœ¨                    | è¯·ç¡®è®¤å‘å¸ƒäº† camera â†’ base_link çš„ TF                              |
| âš ï¸ MoveIt Action Server æ— å“åº”                         | ç¡®ä¿ `move_group` èŠ‚ç‚¹æ­£åœ¨è¿è¡Œ                                     |
| âš ï¸ Link `link6` ä¸åœ¨æ¨¡å‹ä¸­                            | æ£€æŸ¥ SRDF/URDF ä¸­æ˜¯å¦æŒ‡å®šäº†æœ«ç«¯æ‰§è¡Œå™¨ link                          |
| âš ï¸ æ§åˆ¶æˆåŠŸä½†æœºæ¢°è‡‚ä¸åŠ¨                               | æ£€æŸ¥å‘å¸ƒçš„è½¨è¿¹æ˜¯å¦å®Œæ•´ã€ç›®æ ‡ä½ç½®æ˜¯å¦è¿‡è¿‘æˆ–ä¸å¯è¾¾                    |

---

## ğŸ§ª ç¤ºä¾‹æµ‹è¯•å‘½ä»¤

```bash
# å¯åŠ¨è§†è§‰ç›¸æœº + TF
ros2 run tf2_ros static_transform_publisher 0.3 0.15 0.05 0 0 0 camera_link base_link

# å¯åŠ¨ grasp_server
ros2 run piper_control grasp_server

# æ¨¡æ‹Ÿç›®æ ‡ç‚¹
ros2 topic pub /camera_target_point geometry_msgs/PointStamped "{header: {frame_id: 'camera_link'}, point: {x: 0.4, y: 0.1, z: 0.2}}"

# æœ€ç»ˆç¡®è®¤æ‰§è¡ŒåŠ¨ä½œï¼Œæ²¡æœ‰è¿™ä¸ªå‘½ä»¤ æœºæ¢°è‡‚æ˜¯ä¸ä¼šåŠ¨çš„
ros2 service call /grasp_command std_srvs/srv/Trigger "{}"
```

---

## âœ… ä¸‹ä¸€æ­¥å»ºè®®

- é›†æˆè§†è§‰æ£€æµ‹ â†’ è‡ªåŠ¨å‘é€ç›®æ ‡ç‚¹
- åŠ å…¥æŠ“å–å¤±è´¥å¤„ç†æœºåˆ¶ï¼ˆå¦‚å°è¯•å¤šä¸ªå§¿æ€ï¼‰
- åŠ å…¥æŠ“å–åç§»åŠ¨æˆ–æ”¾ç½®æ¨¡å—
- é›†æˆ TTS/è¯­éŸ³æŒ‡ä»¤ç³»ç»Ÿï¼Œå®ç°è‡ªç„¶è¯­è¨€æŠ“å–

---

å¦‚æœä½ éœ€è¦æˆ‘å¸®ä½ è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„ launch æ–‡ä»¶ã€èŠ‚ç‚¹é—´è°ƒç”¨ç»“æ„å›¾ï¼Œæˆ–è€…æ›´å®Œæ•´çš„é›†æˆä¾‹å­ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å‘Šè¯‰æˆ‘ğŸ’¡ï¼
